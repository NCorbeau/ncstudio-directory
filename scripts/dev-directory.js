// scripts/dev-directory.js
// This script runs the development server for a specific directory

import { execSync } from 'child_process';
import dotenv from 'dotenv';
import fs from 'fs';
import path from 'path';

// Load environment variables
dotenv.config();

// Get the directory to run from command line args
const directoryToBuild = process.argv[2];

if (!directoryToBuild) {
  console.error('Please specify a directory ID. Example: npm run dev:directory french-desserts');
  process.exit(1);
}

console.log(`Starting dev server for directory: ${directoryToBuild}`);

// Set environment variables for development
process.env.CURRENT_DIRECTORY = directoryToBuild;
process.env.NODE_ENV = 'development';

// Ensure the .env.local file exists with the current directory
try {
  const envContent = `# Auto-generated by dev-directory.js
CURRENT_DIRECTORY=${directoryToBuild}
`;
  fs.writeFileSync('.env.local', envContent);
  console.log(`Created .env.local with CURRENT_DIRECTORY=${directoryToBuild}`);
} catch (error) {
  console.warn('Could not write .env.local file:', error);
}

// Run Astro dev with the current directory set
try {
  execSync('astro dev', { 
    stdio: 'inherit',
    env: {...process.env}
  });
} catch (error) {
  console.error('Error running development server:', error);
  process.exit(1);
}