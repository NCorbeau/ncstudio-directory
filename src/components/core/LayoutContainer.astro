---
// src/components/core/LayoutContainer.astro
import CardLayout from '../layouts/CardLayout.astro';
import ListLayout from '../layouts/ListLayout.astro';
import MagazineLayout from '../layouts/MagazineLayout.astro';
import MapLayout from '../layouts/MapLayout.astro';
import TableLayout from '../layouts/TableLayout.astro';
import SolidLayoutContainer from '../solid/LayoutContainer';

const { 
  listings, 
  directory, 
  currentLayout,
  categories = [],
  searchParams = '',
  directoryId
} = Astro.props;

// Get available layouts from directory config
const availableLayouts = directory.availableLayouts || ['Card'];
const defaultLayout = directory.defaultLayout || 'Card';

// For server-side rendering, we'll use the provided currentLayout or the default
const initialLayout = currentLayout && availableLayouts.includes(currentLayout) 
  ? currentLayout 
  : defaultLayout;
---

<div class="layout-container-wrapper">
  <!-- SolidJS Component for interactive layout switching -->
  <SolidLayoutContainer 
    listings={listings} 
    directory={directory}
    categories={categories}
    directoryId={directoryId}
    currentLayout={initialLayout}
    searchParams={searchParams}
    client:load
  />
  
  <!-- Pre-render all layouts but hide them initially (except the active one) -->
  <!-- Each layout will be shown/hidden by the SolidJS component -->
  <div id="card-layout" class="layout-content" style={initialLayout === 'Card' ? '' : 'display: none;'}>
    <CardLayout 
      listings={listings} 
      directory={directory}
      categories={categories}
      directoryId={directoryId}
    />
  </div>
  
  <div id="list-layout" class="layout-content" style={initialLayout === 'List' ? '' : 'display: none;'}>
    <ListLayout
      listings={listings}
      directory={directory}
      categories={categories}
      directoryId={directoryId}
    />
  </div>
  
  <div id="magazine-layout" class="layout-content" style={initialLayout === 'Magazine' ? '' : 'display: none;'}>
    <MagazineLayout
      listings={listings}
      directory={directory}
      categories={categories}
      directoryId={directoryId}
    />
  </div>
  
  <div id="map-layout" class="layout-content" style={initialLayout === 'Map' ? '' : 'display: none;'}>
    <MapLayout
      listings={listings}
      directory={directory}
      categories={categories}
      directoryId={directoryId}
    />
  </div>
  
  <div id="table-layout" class="layout-content" style={initialLayout === 'Table' ? '' : 'display: none;'}>
    <TableLayout
      listings={listings}
      directory={directory}
      categories={categories}
      directoryId={directoryId}
    />
  </div>
</div>

<script>
  // Client-side script to handle layout changes from the SolidJS component
  document.addEventListener('layoutchange', (event) => {
    const customEvent = event as CustomEvent;
    const layout = customEvent.detail.layout;
    
    // Hide all layouts
    document.querySelectorAll('.layout-content').forEach(el => {
      el.style.display = 'none';
    });
    
    // Show the selected layout
    const layoutElement = document.getElementById(`${layout.toLowerCase()}-layout`);
    if (layoutElement) {
      layoutElement.style.display = '';
    }
  });
</script>

<style>
  .layout-container-wrapper {
    margin-bottom: 2rem;
  }
  
  .layout-content {
    min-height: 400px; /* Ensure consistent height when switching layouts */
  }
</style>